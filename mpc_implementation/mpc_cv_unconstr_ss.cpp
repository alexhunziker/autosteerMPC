#include <dlib/control.h>
#include <math.h>

using namespace dlib;

const int NR_OF_STATES = 6;
const int NR_OF_CONTROLS = 4;

matrix<double, NR_OF_STATES, NR_OF_STATES> ss_A[3];
matrix<double, NR_OF_STATES, NR_OF_CONTROLS> ss_B[3];

/* 
STATE: 
    Offset Y
    Yaw angle
    Yaw rate
    Schwimm Angle
    Dummy: target yaw
    Velocity

CONTROLS:
    Steering Angle
    Dummy: target yaw
    Acceleration
    Breaks

Linearization for sample time 0.1s

Corresponding MATLAB/SIMULINK Model: mpc_cv_unconstrained
*/

void init_ss()
{
    matrix<double, NR_OF_STATES, NR_OF_STATES> A0;
    A0 = 1.10517091807565, 0, -0.148389680769349, -0.0164113649531852, 0.200430361861406, 0,
    0, 1, 0.0701198468049256, 0.00779874007178865, 0, 0,
    0, 0, 0.475743473586823, 0.0615641544802407, 0, 0,
    0, 0, 0.0564338082735540, 0.00734286491632462, 0, 0,
    0, 0, 0, 0, 0.905742708023549, 0,
    0, 0, 0, 0, 0, 0.990049833749168;
    ss_A[0] = A0;

    matrix<double, NR_OF_STATES, NR_OF_STATES> A1;
    A1 = 1.10517091807565, 0, -0.248789314985990, -0.0388736715014195, 0.300645542792109, 0,
    0, 1, 0.0785349752533981, 0.0123611955044325, 0, 0,
    0, 0, 0.611796985721090, 0.118340002745278, 0, 0,
    0, 0, 0.0536912975418391, 0.0115501940186517, 0, 0,
    0, 0, 0, 0, 0.905742708023549, 0,
    0, 0, 0, 0, 0, 0.990049833749168;
    ss_A[1] = A1;

    matrix<double, NR_OF_STATES, NR_OF_STATES> A2;
    A2 = 1.10517091807565, 0, -0.351671941396346, -0.0688190113177987, 0.400860723722812, 0,
    0, 1, 0.0833457346287162, 0.0164515077131498, 0, 0,
    0, 0, 0.695026331361109, 0.177573429887104, 0, 0,
    0, 0, 0.0517922503837387, 0.0195074084989169, 0, 0,
    0, 0, 0, 0, 0.905742708023549, 0,
    0, 0, 0, 0, 0, 0.990049833749168;
    ss_A[2] = A2;

    matrix<double, NR_OF_STATES, NR_OF_CONTROLS> B0;
    //B0 = -0.00189361884378656, -0.0000990041168678, 0, 0,
    //0.000943577821346703, 0, 0, 0,
    //0.180054220234547, 0, 0, 0,
    //-0.308481871300712, 0, 0, 0,
    //0, -0.00985115631704285, 0, 0,
    //0, 0, 0.00999500166625009, -0.0199900033325002;
    B0 = -0.130455489869064, -0.00991147428988909, 0, 0,
    0.0628877679773124, 0, 0, 0,
    1.08257977931400, 0, 0, 0,
    -0.389095891554744, 0, 0, 0,
    0, -0.0942572919764515, 0, 0,
    0, 0, 0.0995016625083195, -0.199003325016639;
    std::cout << B0;
    ss_B[0] = B0;

    matrix<double, NR_OF_STATES, NR_OF_CONTROLS> B1;
    B1 = -0.217202674137649, -0.0148672114348336, 0, 0,
    0.0698388771518217, 0, 0, 0,
    1.23719463017361, 0, 0, 0,
    -0.410100100252175, 0, 0, 0,
    0, -0.0942572919764515, 0, 0,
    0, 0, 0.0995016625083195, -0.199003325016639;
    ss_B[1] = B1;

    matrix<double, NR_OF_STATES, NR_OF_CONTROLS> B2;
    B2 = -0.308744548881117, -0.0198229485797782, 0, 0,
    0.0744764368965892, 0, 0, 0,
    1.33897273437429, 0, 0, 0,
    -0.418270949505511, 0, 0, 0,
    0, -0.0942572919764515, 0, 0,
    0, 0, 0.0995016625083195, -0.199003325016639;
    ss_B[2] = B2;
}